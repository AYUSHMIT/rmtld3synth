
ifeq ($(OS), Windows_NT)
	EXT=.exe
else
	EXT=""
endif

all: compile install

compile: setup
	dune build --profile release @install

setup: version z3
	cp src/interface/mathkernel_call.ml src/interface/mathkernel_call_.ml
	echo "(* dummy js interface *)" >> src/js/helper_.ml

version:
	echo "let git = \"`git describe --tags` (`git rev-parse HEAD`)\n`uname -m -o` `date +\"%Y-%m-%d %H:%M\"`\"" > src/version.ml

tests:
	mkdir _build_tests && cp -R unittests/* _build_tests && cd _build_tests && bash -ex test.sh allchecks

clean-tests:
	rm _build_tests -r -f

install:
	@echo "OS: ${OS}"
	@echo "Installing rmtld3synth to ${PREFIX}/bin; dune may modify the default path."
	dune install

uninstall:
	dune uninstall


clean:
	dune clean
	rm -f *.byte *.native
	rm -f src/interface/z3solver_.ml src/interface/mathkernel_call_.ml src/js/helper_.ml version.ml

